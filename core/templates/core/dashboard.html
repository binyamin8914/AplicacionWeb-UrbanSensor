{% extends "core/base.html" %}
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dashboard Municipal</title>
  <style>
    :root {
      --primary: #2c3e50;
      --secondary: #3498db;
      --accent: #1abc9c;
      --light: #ecf0f1;
      --dark: #34495e;
      --success: #2ecc71;
      --warning: #f39c12;
      --danger: #e74c3c;
      --gray: #95a5a6;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #f5f7fa;
      margin: 0;
      padding: 0;
      color: var(--dark);
    }

    .container {
      padding: 20px;
      max-width: 1200px;
      margin: 0 auto;
    }

    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
      padding-bottom: 15px;
      border-bottom: 1px solid #e0e0e0;
    }

    .status-indicator {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 0.9em;
    }

    .status-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background-color: var(--success);
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0% { opacity: 1; }
      50% { opacity: 0.5; }
      100% { opacity: 1; }
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .logo-icon {
      width: 40px;
      height: 40px;
      background-color: var(--primary);
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: bold;
    }

    .logo-text {
      font-size: 1.5em;
      font-weight: 600;
      color: var(--primary);
    }

    .user-info {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .user-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background-color: var(--secondary);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: bold;
    }

    .cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .card {
      background-color: white;
      border-radius: 10px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
      padding: 20px;
      border-left: 4px solid var(--secondary);
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .card.updating {
      background-color: #f8f9fa;
    }

    .card::after {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
      transition: left 0.5s;
    }

    .card.updating::after {
      left: 100%;
    }

    .card:nth-child(1) { border-left-color: var(--secondary); }
    .card:nth-child(2) { border-left-color: var(--accent); }
    .card:nth-child(3) { border-left-color: var(--warning); }
    .card:nth-child(4) { border-left-color: var(--danger); }
    .card:nth-child(5) { border-left-color: var(--success); }

    .card h3 {
      margin: 0;
      font-size: 1em;
      color: var(--gray);
      font-weight: 500;
    }

    .card p {
      font-size: 2em;
      font-weight: 700;
      margin: 10px 0 0 0;
      color: var(--dark);
      transition: all 0.3s ease;
    }

    .card .change-indicator {
      font-size: 0.8em;
      margin-left: 8px;
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .card .change-indicator.positive {
      color: var(--success);
      opacity: 1;
    }

    .card .change-indicator.negative {
      color: var(--danger);
      opacity: 1;
    }

    .buttons {
      display: flex;
      justify-content: flex-start;
      flex-wrap: wrap;
      gap: 15px;
      margin-bottom: 40px;
    }

    .btn {
      border: none;
      padding: 12px 25px;
      border-radius: 6px;
      font-size: 0.9em;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .btn-primary {
      background-color: var(--secondary);
      color: white;
    }

    .btn-success {
      background-color: var(--success);
      color: white;
    }

    .btn-warning {
      background-color: var(--warning);
      color: white;
    }

    .btn-danger {
      background-color: var(--danger);
      color: white;
    }

    .btn-info {
      background-color: var(--accent);
      color: white;
    }

    .btn:hover {
      opacity: 0.9;
      transform: translateY(-2px);
    }

    .dashboard-content {
      display: grid;
      grid-template-columns: 2fr 1fr;
      gap: 30px;
    }

    .graph-container {
      background-color: white;
      border-radius: 10px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
      padding: 20px;
      margin-bottom: 30px;
    }

    .graph-container h2 {
      margin-top: 0;
      color: var(--primary);
      font-size: 1.3em;
      font-weight: 600;
    }

    .graph {
      width: 100%;
      height: 300px;
      display: flex;
      align-items: flex-end;
      justify-content: space-around;
      padding: 20px 0;
    }

    .bar-group {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 5px;
      flex: 1;
    }

    .bar-label {
      font-size: 0.8em;
      color: var(--gray);
      text-align: center;
      margin-bottom: 10px;
    }

    .bar-container {
      height: 200px;
      display: flex;
      align-items: flex-end;
      justify-content: center;
      width: 100%;
      position: relative;
    }

    .bar {
      width: 50px;
      border-radius: 8px 8px 0 0;
      margin: 0 5px;
      transition: all 0.5s ease;
    }

    .bar:hover {
      opacity: 0.8;
      transform: scale(1.05);
    }

    .bar-usuarios {
      background-color: var(--secondary);
    }

    .bar-creadas {
      background-color: var(--accent);
    }

    .bar-derivadas {
      background-color: var(--warning);
    }

    .bar-rechazadas {
      background-color: var(--danger);
    }

    .bar-finalizadas {
      background-color: var(--success);
    }

    .bar-value {
      position: absolute;
      top: -25px;
      font-size: 0.8em;
      font-weight: 600;
      color: var(--dark);
    }

    .legend {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 15px;
      margin-top: 20px;
    }

    .legend-item {
      display: flex;
      align-items: center;
      gap: 5px;
      font-size: 0.8em;
    }

    .legend-color {
      width: 12px;
      height: 12px;
      border-radius: 2px;
    }

    /* ==== TABLA DE REPORTES ==== */
    .reportes {
      background-color: white;
      border-radius: 10px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
      padding: 20px;
    }

    .reportes h2 {
      margin-top: 0;
      color: var(--primary);
      font-size: 1.3em;
      font-weight: 600;
    }

    .tabla-reportes {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
    }

    .tabla-reportes th {
      text-align: left;
      padding: 12px 10px;
      border-bottom: 1px solid #e0e0e0;
      color: var(--gray);
      font-weight: 500;
      font-size: 0.9em;
    }

    .tabla-reportes td {
      padding: 12px 10px;
      border-bottom: 1px solid #f0f0f0;
    }

    .tabla-reportes tr:last-child td {
      border-bottom: none;
    }

    .estado-activa {
      color: var(--success);
      font-weight: 600;
    }

    .estado-inactiva {
      color: var(--gray);
      font-weight: 600;
    }

    .estado-proceso {
      color: var(--warning);
      font-weight: 600;
    }

    .prioridad-alta {
      color: var(--danger);
      font-weight: 600;
    }

    .prioridad-baja {
      color: var(--success);
      font-weight: 600;
    }

    .prioridad-normal {
      color: var(--warning);
      font-weight: 600;
    }

    .badge {
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 0.8em;
      font-weight: 600;
    }

    .badge-activa {
      background-color: rgba(46, 204, 113, 0.1);
    }

    .badge-inactiva {
      background-color: rgba(149, 165, 166, 0.1);
    }

    .badge-proceso {
      background-color: rgba(243, 156, 18, 0.1);
    }

    .badge-alta {
      background-color: rgba(231, 76, 60, 0.1);
    }

    .badge-baja {
      background-color: rgba(46, 204, 113, 0.1);
    }

    .badge-normal {
      background-color: rgba(243, 156, 18, 0.1);
    }

    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      background: var(--success);
      color: white;
      padding: 12px 20px;
      border-radius: 6px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      transform: translateX(150%);
      transition: transform 0.3s ease;
      z-index: 1000;
    }

    .notification.show {
      transform: translateX(0);
    }

    @media (max-width: 768px) {
      .dashboard-content {
        grid-template-columns: 1fr;
      }
      
      .buttons {
        justify-content: center;
      }
      
      header {
        flex-direction: column;
        gap: 15px;
        align-items: flex-start;
      }
    }
  </style>
</head>
<body>
  <div class="notification" id="updateNotification">
    Datos actualizados correctamente
  </div>

  <div class="container">
    <header>
      <div class="logo">
        <div class="logo-icon">M</div>
        <div class="logo-text">Municipalidad</div>
        <div class="status-indicator">
          <div class="status-dot" id="statusDot"></div>
          <span id="statusText">Conectado</span>
        </div>
      </div>
      <div class="user-info">
        <div class="user-avatar">AD</div>
        <div>Administrador</div>
      </div>
    </header>

    <!-- Tarjetas de Métricas -->
    <div class="cards">
      <div class="card" id="card-usuarios">
        <h3>Usuarios Disponibles</h3>
        <p id="usuarios-disponibles">45</p>
      </div>
      <div class="card" id="card-creadas">
        <h3>Incidencias Creadas</h3>
        <p id="incidencias-creadas">120</p>
      </div>
      <div class="card" id="card-derivadas">
        <h3>Incidencias Derivadas</h3>
        <p id="incidencias-derivadas">85</p>
      </div>
      <div class="card" id="card-rechazadas">
        <h3>Incidencias Rechazadas</h3>
        <p id="incidencias-rechazadas">12</p>
      </div>
      <div class="card" id="card-finalizadas">
        <h3>Incidencias Finalizadas</h3>
        <p id="incidencias-finalizadas">65</p>
      </div>
    </div>

    <!-- Botones Completos -->
    <div class="buttons">
      <button class="btn btn-success">
        <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M8 1V15M1 8H15" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
        Crear encuesta +
      </button>
      <button class="btn btn-danger">
        <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M12 4L4 12M4 4L12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
        Bloquear
      </button>
      <button class="btn btn-warning">
        <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M8 12V8M8 4H8.01M15 8C15 11.866 11.866 15 8 15C4.13401 15 1 11.866 1 8C1 4.13401 4.13401 1 8 1C11.866 1 15 4.13401 15 8Z" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
        Inactivo
      </button>
      <button class="btn btn-info">
        <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M1 8L6 13L15 4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        Derivar
      </button>
      <button class="btn btn-primary" id="btn-refresh">
        <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M13.5 8C13.5 9.15761 13.0586 10.2723 12.2587 11.1111C11.4589 11.9499 10.357 12.5 9.16667 12.5C7.97634 12.5 6.87443 11.9499 6.07458 11.1111C5.27472 10.2723 4.83333 9.15761 4.83333 8C4.83333 6.84239 5.27472 5.72772 6.07458 4.88889C6.87443 4.05006 7.97634 3.5 9.16667 3.5C10.357 3.5 11.4589 4.05006 12.2587 4.88889C13.0586 5.72772 13.5 6.84239 13.5 8V8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M10.5 6L13.5 3L10.5 0" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        Actualizar Datos
      </button>
    </div>

    <div class="dashboard-content">
      <!-- Gráfico de Métricas Principales -->
      <div class="graph-container">
        <h2>Resumen de Métricas Principales</h2>
        <div class="graph" id="metricas-principales-chart">
          <!-- Las barras se generarán dinámicamente con JavaScript -->
        </div>
        <div class="legend">
          <div class="legend-item">
            <div class="legend-color bar-usuarios"></div>
            <span>Usuarios</span>
          </div>
          <div class="legend-item">
            <div class="legend-color bar-creadas"></div>
            <span>Creadas</span>
          </div>
          <div class="legend-item">
            <div class="legend-color bar-derivadas"></div>
            <span>Derivadas</span>
          </div>
          <div class="legend-item">
            <div class="legend-color bar-rechazadas"></div>
            <span>Rechazadas</span>
          </div>
          <div class="legend-item">
            <div class="legend-color bar-finalizadas"></div>
            <span>Finalizadas</span>
          </div>
        </div>
      </div>

      <!-- Reportes -->
      <div class="reportes">
        <h2>Incidencias Recientes</h2>
        <table class="tabla-reportes">
          <thead>
            <tr>
              <th>Reporte</th>
              <th>Área</th>
              <th>Estado</th>
              <th>Prioridad</th>
            </tr>
          </thead>
          <tbody id="recent-incidents-body">
            <!-- Los datos se cargarán dinámicamente -->
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <script>
    class RealTimeDashboard {
      constructor() {
        this.currentData = {
          usuarios_disponibles: 45,
          incidencias_creadas: 120,
          incidencias_derivadas: 85,
          incidencias_rechazadas: 12,
          incidencias_finalizadas: 65,
          incidencias_recientes: [
            { reporte: "Vereda mal estado", area: "Construcción", estado: "ACTIVA", prioridad: "ALTA" },
            { reporte: "Caída de árbol", area: "Forestal", estado: "INACTIVA", prioridad: "BAJA" },
            { reporte: "Alcantarilla tapada", area: "Agua", estado: "PROCESO", prioridad: "NORMAL" }
          ]
        };

        this.websocket = null;
        this.pollingInterval = null;
        this.init();
      }

      init() {
        this.renderInitialData();
        this.setupEventListeners();
        this.startPolling();
        // this.connectWebSocket(); // Descomentar cuando tengas WebSockets configurados
      }

      setupEventListeners() {
        document.getElementById('btn-refresh').addEventListener('click', () => {
          this.fetchData();
        });

        // Agregar event listeners para los otros botones
        document.querySelector('.btn-success').addEventListener('click', () => {
          this.crearEncuesta();
        });

        document.querySelector('.btn-danger').addEventListener('click', () => {
          this.bloquearUsuario();
        });

        document.querySelector('.btn-warning').addEventListener('click', () => {
          this.marcarInactivo();
        });

        document.querySelector('.btn-info').addEventListener('click', () => {
          this.derivarIncidencia();
        });
      }

      // Métodos para los botones
      crearEncuesta() {
        alert('Función: Crear nueva encuesta');
        // Aquí iría la lógica para crear una encuesta
      }

      bloquearUsuario() {
        alert('Función: Bloquear usuario seleccionado');
        // Aquí iría la lógica para bloquear usuario
      }

      marcarInactivo() {
        alert('Función: Marcar como inactivo');
        // Aquí iría la lógica para marcar inactivo
      }

      derivarIncidencia() {
        alert('Función: Derivar incidencia');
        // Aquí iría la lógica para derivar incidencia
      }

      // Método para WebSockets (ideal para tiempo real)
      connectWebSocket() {
        try {
          // Cambia esta URL por tu endpoint de WebSockets
          this.websocket = new WebSocket('ws://localhost:8000/ws/dashboard/');
          
          this.websocket.onopen = () => {
            console.log('WebSocket conectado');
            this.updateConnectionStatus(true);
          };

          this.websocket.onmessage = (event) => {
            const data = JSON.parse(event.data);
            this.updateDashboard(data);
          };

          this.websocket.onclose = () => {
            console.log('WebSocket desconectado');
            this.updateConnectionStatus(false);
            // Reintentar conexión después de 10 segundos
            setTimeout(() => this.connectWebSocket(), 10000);
          };

          this.websocket.onerror = (error) => {
            console.error('Error en WebSocket:', error);
            this.updateConnectionStatus(false);
          };

        } catch (error) {
          console.error('Error al conectar WebSocket:', error);
          this.updateConnectionStatus(false);
        }
      }

      // Método de polling como alternativa
      startPolling() {
        this.pollingInterval = setInterval(() => {
          this.fetchData();
        }, 20000); // Actualizar cada 20 segundos
      }

      async fetchData() {
        try {
          this.showUpdatingState();
          
          // Simular llamada a la API - reemplaza con tu endpoint real
          // const response = await fetch('/api/dashboard/data/');
          // const newData = await response.json();
          
          // Por ahora, simulamos datos nuevos
          const newData = this.generateNewData();
          
          this.updateDashboard(newData);
          this.showNotification('Datos actualizados correctamente');
          
        } catch (error) {
          console.error('Error al obtener datos:', error);
          this.showNotification('Error al actualizar datos', 'error');
        } finally {
          this.hideUpdatingState();
        }
      }

      generateNewData() {
        // Simular cambios en los datos
        return {
          usuarios_disponibles: Math.max(40, this.currentData.usuarios_disponibles + Math.floor(Math.random() * 6 - 2)),
          incidencias_creadas: this.currentData.incidencias_creadas + Math.floor(Math.random() * 5),
          incidencias_derivadas: this.currentData.incidencias_derivadas + Math.floor(Math.random() * 4),
          incidencias_rechazadas: this.currentData.incidencias_rechazadas + Math.floor(Math.random() * 2),
          incidencias_finalizadas: this.currentData.incidencias_finalizadas + Math.floor(Math.random() * 3),
          incidencias_recientes: this.generateNewRecentIncidents()
        };
      }

      generateNewRecentIncidents() {
        const incidents = [...this.currentData.incidencias_recientes];
        // Rotar y actualizar incidentes
        incidents.pop();
        const newIncident = {
          reporte: `Nueva incidencia ${Math.floor(Math.random() * 1000)}`,
          area: ['Construcción', 'Forestal', 'Agua', 'Social'][Math.floor(Math.random() * 4)],
          estado: ['ACTIVA', 'INACTIVA', 'PROCESO'][Math.floor(Math.random() * 3)],
          prioridad: ['ALTA', 'NORMAL', 'BAJA'][Math.floor(Math.random() * 3)]
        };
        incidents.unshift(newIncident);
        return incidents;
      }

      updateDashboard(newData) {
        const oldData = { ...this.currentData };
        this.currentData = newData;

        this.updateMetrics(oldData);
        this.updateChart();
        this.updateRecentIncidents();
      }

      updateMetrics(oldData) {
        const metrics = [
          { id: 'usuarios-disponibles', key: 'usuarios_disponibles' },
          { id: 'incidencias-creadas', key: 'incidencias_creadas' },
          { id: 'incidencias-derivadas', key: 'incidencias_derivadas' },
          { id: 'incidencias-rechazadas', key: 'incidencias_rechazadas' },
          { id: 'incidencias-finalizadas', key: 'incidencias_finalizadas' }
        ];

        metrics.forEach(metric => {
          const element = document.getElementById(metric.id);
          const card = element.closest('.card');
          const oldValue = oldData[metric.key];
          const newValue = this.currentData[metric.key];

          // Animación de cambio
          card.classList.add('updating');
          setTimeout(() => {
            element.textContent = newValue;
            
            // Mostrar indicador de cambio
            const change = newValue - oldValue;
            if (change !== 0) {
              const indicator = document.createElement('span');
              indicator.className = `change-indicator ${change > 0 ? 'positive' : 'negative'}`;
              indicator.textContent = change > 0 ? `+${change}` : `${change}`;
              element.appendChild(indicator);
              
              setTimeout(() => {
                indicator.remove();
              }, 3000);
            }
            
            card.classList.remove('updating');
          }, 300);
        });
      }

      updateChart() {
        this.generarGraficoMetricasPrincipales();
      }

      updateRecentIncidents() {
        const tbody = document.getElementById('recent-incidents-body');
        tbody.innerHTML = '';

        this.currentData.incidencias_recientes.forEach(incident => {
          const row = document.createElement('tr');
          
          const estadoClass = `estado-${incident.estado.toLowerCase()}`;
          const prioridadClass = `prioridad-${incident.prioridad.toLowerCase()}`;
          const badgeClass = `badge-${incident.estado.toLowerCase()}`;
          const prioridadBadgeClass = `badge-${incident.prioridad.toLowerCase()}`;

          row.innerHTML = `
            <td>${incident.reporte}</td>
            <td>${incident.area}</td>
            <td><span class="${estadoClass} badge ${badgeClass}">${incident.estado}</span></td>
            <td><span class="${prioridadClass} badge ${prioridadBadgeClass}">${incident.prioridad}</span></td>
          `;
          
          tbody.appendChild(row);
        });
      }

      generarGraficoMetricasPrincipales() {
        const contenedor = document.getElementById('metricas-principales-chart');
        contenedor.innerHTML = '';
        
        const metricas = [
          { 
            label: 'Usuarios', 
            value: this.currentData.usuarios_disponibles, 
            class: 'bar-usuarios',
            title: 'Usuarios Disponibles'
          },
          { 
            label: 'Creadas', 
            value: this.currentData.incidencias_creadas, 
            class: 'bar-creadas',
            title: 'Incidencias Creadas'
          },
          { 
            label: 'Derivadas', 
            value: this.currentData.incidencias_derivadas, 
            class: 'bar-derivadas',
            title: 'Incidencias Derivadas'
          },
          { 
            label: 'Rechazadas', 
            value: this.currentData.incidencias_rechazadas, 
            class: 'bar-rechazadas',
            title: 'Incidencias Rechazadas'
          },
          { 
            label: 'Finalizadas', 
            value: this.currentData.incidencias_finalizadas, 
            class: 'bar-finalizadas',
            title: 'Incidencias Finalizadas'
          }
        ];

        // Encontrar el valor máximo para escalar
        const maxValor = Math.max(...metricas.map(m => m.value));
        const escala = 180 / Math.max(maxValor, 1);

        metricas.forEach(metrica => {
          const barGroup = document.createElement('div');
          barGroup.className = 'bar-group';
          
          const label = document.createElement('div');
          label.className = 'bar-label';
          label.textContent = metrica.label;
          barGroup.appendChild(label);
          
          const barContainer = document.createElement('div');
          barContainer.className = 'bar-container';
          
          const bar = document.createElement('div');
          bar.className = `bar ${metrica.class}`;
          bar.style.height = `${metrica.value * escala}px`;
          bar.title = `${metrica.title}: ${metrica.value}`;
          
          // Añadir valor numérico sobre la barra
          const valueLabel = document.createElement('div');
          valueLabel.className = 'bar-value';
          valueLabel.textContent = metrica.value;
          
          barContainer.appendChild(bar);
          barContainer.appendChild(valueLabel);
          barGroup.appendChild(barContainer);
          contenedor.appendChild(barGroup);
        });
      }

      renderInitialData() {
        this.updateMetrics(this.currentData);
        this.updateChart();
        this.updateRecentIncidents();
      }

      showUpdatingState() {
        document.querySelectorAll('.card').forEach(card => {
          card.classList.add('updating');
        });
      }

      hideUpdatingState() {
        setTimeout(() => {
          document.querySelectorAll('.card').forEach(card => {
            card.classList.remove('updating');
          });
        }, 500);
      }

      showNotification(message, type = 'success') {
        const notification = document.getElementById('updateNotification');
        notification.textContent = message;
        notification.style.background = type === 'error' ? 'var(--danger)' : 'var(--success)';
        notification.classList.add('show');
        
        setTimeout(() => {
          notification.classList.remove('show');
        }, 3000);
      }

      updateConnectionStatus(connected) {
        const dot = document.getElementById('statusDot');
        const text = document.getElementById('statusText');
        
        if (connected) {
          dot.style.backgroundColor = 'var(--success)';
          text.textContent = 'Conectado';
        } else {
          dot.style.backgroundColor = 'var(--danger)';
          text.textContent = 'Desconectado';
        }
      }
    }

    // Inicializar el dashboard cuando la página cargue
    document.addEventListener('DOMContentLoaded', () => {
      new RealTimeDashboard();
    });
  </script>
</body>
</html>
{% endblock %}